<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>MRiskAssessment Join</title>
        <!-- <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css"/> -->
        <link rel="stylesheet" type="text/css" href="/css/mrastyle.css"/>
        
        <!-- Favicon -->
		<link rel="shortcut icon" href="favicon.ico">
		
		<!-- CSS Global Compulsory -->
		 <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css"> 
		<link rel="stylesheet" href="/assets/css/style.css">
		
		<!-- CSS Implementing Plugins -->
		<link rel="stylesheet" href="/assets/plugins/line-icons/line-icons.css">
		<link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="/assets/plugins/sky-forms/version-2.0.1/css/custom-sky-forms.css">
		
		<!-- CSS Page Style -->    
		<link rel="stylesheet" href="/assets/css/pages/page_log_reg_v1.css">
		
		<!-- CSS Theme -->    
		<link rel="stylesheet" href="/assets/css/theme-colors/default.css">
		
		<!-- CSS Customization -->
		<link rel="stylesheet" href="/assets/css/custom.css">
		
		<!-- Datatables -->
		<link rel="stylesheet" href="/assets/css/custom.css">
		<link rel="stylesheet" href="/plugin/Datatables/css/dataTables.bootstrap.css">
		<link rel="stylesheet" href="/plugin/Datatables/css/dataTables.responsive.css">
		
		
		<!-- <script type="text/javascript" src="/js/jquery-3.6.1.min.js"></script> -->
        <!-- <script type="text/javascript" src="/js/bootstrap.min.js"></script> --> 
        <!-- JS Global Compulsory -->           
		 <script type="text/javascript" src="/assets/plugins/jquery/jquery.min.js"></script>
		<script type="text/javascript" src="/assets/plugins/jquery/jquery-migrate.min.js"></script>
		 <script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script> 
		<!-- JS Implementing Plugins --> 
		<script type="text/javascript" src="/assets/plugins/back-to-top.js"></script>
		<!-- JS Page Level -->           
		<script type="text/javascript" src="/assets/js/app.js"></script>
		<script type="text/javascript" src="/assets/js/app.js"></script>
		<script type="text/javascript" src="/plugin/Datatables/js/jquery.dataTables.js"></script>
		<script type="text/javascript" src="/plugin/Datatables/js/dataTables.bootstrap.js"></script>
		<script type="text/javascript" src="/plugin/Datatables/js/dataTables.responsive.min.js"></script>
		<style>
			body {
				background-color: #f5f5f5;
			}
			
			div .container content {
				background-color: #f5f5f5;	
			}
			
			i .hide {
				display: none;
			}
			
		</style>
    </head>
    <body>
    	<div class="wrapper">   
		    <div class="breadcrumbs">
		        <div class="container">
		            <h1 class="pull-left"><img id="logo-header" src="/img/logo/logo3.png" alt="Logo" style="width:100px;"></h1>
		            <ul class="pull-right breadcrumb">
		                <li><a href="/login">로그인</a></li>
		                <li class="active">회원가입</li>
		            </ul>
		        </div>
		    </div>
		    <div class="container content">
		        <div class="row ">
		            <div class="col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
		                <form class="reg-page" id="regForm" method="post" action="/join/joinRegis">
		                    <div class="reg-header">
		                        <h2>회원가입</h2>
		                        <p>Already Signed Up? Click <a href="/login" class="color-blue">Sign In</a> to login your account.</p>                    
		                    </div>
		                    <label>아이디 <span class="color-red">*</span></label>
		                    <input type="text" name="USER_ID" class="form-control margin-bottom-20">
							<label>이메일 <span class="color-red">*</span></label>
		                    <input type="text" class="form-control margin-bottom-20">	
		                    <div class="row">
		                        <div class="col-sm-6">
		                            <label>비밀번호 <span class="color-red">*</span></label>
		                            <input type="password" name="PASS_ID" class="form-control margin-bottom-20">
		                        </div>
		                        <div class="col-sm-6">
		                            <label>비밀번호 확인 <span class="color-red">*</span></label>
		                            <input type="password" class="form-control margin-bottom-20">
		                        </div>
		                    </div>
		                    <label>이름 <span class="color-red">*</span></label>
		                    <input type="text" class="form-control margin-bottom-20">
		                    <label>회사 및 대표현장 <span class="color-red">*</span></label>
		                    <div class="row margin-bottom-20">
		                        <div class="col-sm-6">
		                            <div class="input-group">
		                                <input type="hidden" class="form-control" id="txtCompanyId" name="COMPANY_ID">
		                                <input type="text" class="form-control" id="txtCompanyNm">
		                                <span class="input-group-btn">
		                                    <button id="searchCompanyId" class="btn btn-danger" type="button"><i class="icon-append fa fa-search"></i></button>
		                                </span>
		                            </div>
		                        </div>
		                        <div class="col-sm-6">
		                           <div class="input-group">
		                                <input type="hidden" class="form-control" id="txtProjCode" name="PROJ_CODE">
		                                <input type="text" class="form-control" id="txtProjNm">
		                                <span class="input-group-btn">
		                                    <button id="searchProjCode" class="btn btn-danger" type="button"><i class="icon-append fa fa-search"></i></button>
		                                </span>
		                            </div>
		                        </div>
		                    </div>
		                    <label>전화번호</label>
		                    <input type="text" class="form-control margin-bottom-20" name="TEL_NO">
		                    <label>휴대전화번호</label>
		                    <input type="text" class="form-control margin-bottom-20" name="MOBILE_NO">
		                    <label>직위</label>
		                    <div class="sky-form" style="border:none;">
	                            <label class="select">
	                                <select id = "sltPosi" name="POSITION_CD">
	                                    <option value="0"></option>
	                                </select>
	                                <i></i>
	                            </label>
                            </div>
                            <hr>
		                    <div class="row">
		                        <div class="col-lg-6 checkbox">
		                            <label>
		                                <input type="checkbox"> 
		                                I read <a href="page_terms.html" class="color-green">Terms and Conditions</a>
		                            </label>                        
		                        </div>
		                        <div class="col-lg-6 text-right">
		                            <button class="btn-u" type="submit">가입요청</button>                        
		                        </div>
		                    </div>
		                </form>
		            </div>
		        </div>
		    </div>	
	    </div>
	    
	     
	    <div id="divModalSearchCompanyId" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modalSearchCts" aria-hidden="true">
			<div class="modal-dialog modal-md">
				<div class="modal-content">
					<div class="modal-header"> 
						<button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>
						<h4 class="modal-title" style="font-weight:bolder">회사검색</h4>
					</div>
					<div class="modal-body" >
						<div class="profile">	            	 
					        <div class="profile-body">
						        <div class="alert alert-warning fade in" style="margin-bottom:0px;">
									<label>회사</label>
					                <div class="row">
					                    <div class="col-sm-12"> 	
				                    		<div class="input-group">
				                                <input type="text" class="form-control" id="txtSearchCompanyNm">
				                                <span class="input-group-btn">
				                                    <button id="searchCompanyLst" class="btn-u btn-u-yellow" type="button"><i class="icon-append fa fa-search"></i></button>
				                                </span>
				                            </div>					                    			 
										</div>
		                			</div>
		                		</div>
		                	</div>
		                </div>
						<div class="profile">	            	 
				        	<div class="profile-body">
								<div id="idDivCompanyLst" class="listTable" style="width:100%; height:440px;"> 
									<table class="idTbCompanyLst table table-bordered dt-responsive" cellspacing="0" width="100%">				
										<thead>
											<tr>			
												<th>회사명</th>																												
												<th>사업자번호</th>
											</tr>										
										</thead>																								
									</table>
								</div>
				        	</div>
						</div>	
					</div>				
					<div class="modal-footer">
						<button id="idBtnCpnRtn" class="btn-u btn-u-blue" type="button">확인</button>
						<button data-dismiss="modal" class="btn-u btn-u-default" type="button">닫기</button>						
					</div>
				</div>
			</div>	
		</div>
		
		<div id="divModalSearchProjLst" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modalSearchCts" aria-hidden="true">
			<div class="modal-dialog modal-md">
				<div class="modal-content">
					<div class="modal-header"> 
						<button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>
						<h4 class="modal-title" style="font-weight:bolder">현장검색</h4>
					</div>
					<div class="modal-body" >
						<div class="profile">	            	 
					        <div class="profile-body">
						        <div class="alert alert-warning fade in" style="margin-bottom:0px;">
									<label>회사</label>
					                <div class="row">
					                    <div class="col-sm-12"> 	
				                    		<div class="input-group">
				                                <input type="text" class="form-control" id="txtSearchProjNm">
				                                <span class="input-group-btn">
				                                    <button id="searchProjLst" class="btn-u btn-u-yellow" type="button"><i class="icon-append fa fa-search"></i></button>
				                                </span>
				                            </div>					                    			 
										</div>
		                			</div>
		                		</div>
		                	</div>
		                </div>
						<div class="profile">	            	 
				        	<div class="profile-body">
								<div id="idDivProjLst" class="listTable" style="width:100%; height:440px;"> 
									<table class="idTbProjLst table table-bordered dt-responsive" cellspacing="0" width="100%">				
										<thead>
											<tr>			
												<th>현장명</th>																												
												<th>비고</th>
											</tr>										
										</thead>																								
									</table>
								</div>
				        	</div>
						</div>	
					</div>				
					<div class="modal-footer">
						<button id="idBtnProjRtn" class="btn-u btn-u-blue" type="button">확인</button>
						<button data-dismiss="modal" class="btn-u btn-u-default" type="button">닫기</button>						
					</div>
				</div>
			</div>	
		</div>
		
		
		         
		<script th:inline="javascript">
			$(function() {
				var schCpnCondition = "";
				var schProjCondition = "";
				var schCpnId;
				var rtnCpnNm = "";
				var rtnCpnId = "";
				var rtnProjCode = "";
				var rtnProjName = "";
				
				
				// 회사검색
				$("#searchCompanyId").on("click", function(e) {
					schCpnCondition = $("#txtCompanyNm").val();
					$("#txtSearchCompanyNm").val(schCpnCondition);
					
					drawCompanyLst.draw();
					
					$("#divModalSearchCompanyId").modal("show");
					
				});
				
				// 현장검색
				$("#searchProjCode").on("click", function(e) {
					schCpnId = $("#txtCompanyId").val();
					schProjCondition = $("#txtProjNm").val();
					$("#txtSearchProjNm").val(schProjCondition);
					
					drawProjLst.draw();
					
					$("#divModalSearchProjLst").modal("show");
					
				});
				
				// 직위검색
				$("#searchPosiCd").on("click", function(e) {
					
				});	
				
				$("#txtSearchCompanyNm").on("change", function() {
					schCpnCondition = $("#txtSearchCompanyNm").val();
					drawCompanyLst.draw();
				});
				
				$("#txtSearchProjNm").on("change", function() {
					schProjCondition = $("#txtSearchCompanyNm").val();
					drawProjLst.draw();
				});
				
				$("#divModalSearchCompanyId").on("hidden.bs.modal", function() {
					schCpnCondition = "";
					
					if(!rtnCpnNm) {
						$("#txtCompanyId").val("");
						$("#txtCompanyNm").val(schCpnCondition);	
					}
					/*
					if(rtnCpnNm) {
						$("#txtCompanyId").val(rtnCpnId);
						$("#txtCompanyNm").val(rtnCpnNm);
					} else {
						$("#txtCompanyId").val("");
						$("#txtCompanyNm").val(schCpnCondition);	
					}
					*/
				});
				
				$("#divModalSearchCompanyId").on("shown.bs.modal", function() {
				});
				
				
				
				$("#idBtnCpnRtn").on("click", function() {
					if(rtnCpnNm) {
						$("#txtCompanyId").val(rtnCpnId);
						$("#txtCompanyNm").val(rtnCpnNm);
						
						$("#divModalSearchCompanyId").modal("toggle");
					} else {
						alert("회사를 선택하세요.");
					}
				});
				

				$("#idBtnProjRtn").on("click", function() {
					if(rtnProjName) {
						$("#txtProjCode").val(rtnProjCode);
						$("#txtProjNm").val(rtnProjName);
						
						$("#divModalSearchProjLst").modal("toggle");
					} else {
						alert("현장을 선택하세요.");
					}
				});
				
				$.ajax({
					type: "get",
					url: "/join/searchPosiCode",
					data: {
						grpCodeNm: "직위"
					},
					asyn: false,
					dataType: "json",
					success: function(aoData) {
						if(aoData.bSuccess) {
							var sHtml = "";

							$.each(aoData.data, function(idx, aoRtn) {
								sHtml += '<option value=' + aoRtn.SCM_DTL_SEQ + '>' + aoRtn.CODE_DTL_NM + '</option>';  
							});
							
							$("#sltPosi").append(sHtml);
						}
					},
					error: function(xhr, status, error) {
						console.log(error);	
					}
				});
				
				
				
				// 회사 데이터 가져오기
				var drawCompanyLst = $("#idDivCompanyLst .idTbCompanyLst").DataTable({
					processing: true,
					serverSide: true,
					ajax: {
						type: "post",
						url: "/join/searchCompanyId",
						data: function(dat) {
							dat.companyName = schCpnCondition;
						}
					},
					
					columns: [
						{
							data: "COMPANY_NAME",
							render: function(data, type, full, meta) {
								var sHtml = '';
								
								sHtml += '<span id="span_RID_' + Number(meta.row+1) + '"><i class="icon-append fa fa-check hide"></i> </span>' + data; 
								
								return sHtml;
							}
						},
						{data: "BIZ_NO"}
					],
					pagingType: "simple_numbers",
					lengthChange: false,
					pageLength: 10,
					info: false,
					ordering: false,
					searching: false,
					language: {
						"zeroRecords": "자료가 없습니다."
					}
				});
				
				// 현장 데이터 가져오기
				var drawProjLst = $("#idDivProjLst .idTbProjLst").DataTable({
					processing: true,
					serverSide: true,
					ajax: {
						type: "post",
						url: "/join/searchProjCode",
						data: function(dat) {
							dat.companyId = schCpnId;
							dat.projName = schProjCondition;
						}
					},
					
					columns: [
						{
							data: "PROJ_NAME",
							render: function(data, type, full, meta) {
								var sHtml = '';
								
								sHtml += '<span id="span2_RID_' + Number(meta.row+1) + '"><i class="icon-append fa fa-check hide"></i> </span>' + data; 
								
								return sHtml;
							}
						},
						{data: "RMK"}
					],
					pagingType: "simple_numbers",
					lengthChange: false,
					pageLength: 10,
					info: false,
					ordering: false,
					searching: false,
					language: {
						"zeroRecords": "자료가 없습니다."
					}
				});
				
				$('#idDivCompanyLst tbody').on('click', 'tr', function () {
					var evtCpnt = $("#span_" + drawCompanyLst.row(this).data().DT_RowId);
					
					$('#idDivCompanyLst tbody span i').not(evtCpnt.children("i")).addClass("hide");
					
					if(evtCpnt.children("i").hasClass("hide")) {
						rtnCpnId = drawCompanyLst.row(this).data().COMPANY_ID;
						rtnCpnNm = drawCompanyLst.row(this).data().COMPANY_NAME;
						evtCpnt.children("i").removeClass("hide");
					} else {
						rtnCpnId = "";
						rtnCpnNm = "";
						evtCpnt.children("i").addClass("hide");
					}
				
				});
				
				$('#idDivProjLst tbody').on('click', 'tr', function () {
					var evtCpnt = $("#span2_" + drawProjLst.row(this).data().DT_RowId);
					
					$('#idDivProjLst tbody span i').not(evtCpnt.children("i")).addClass("hide");
					
					if(evtCpnt.children("i").hasClass("hide")) {
						rtnProjCode = drawProjLst.row(this).data().PROJ_CODE;
						rtnProjName = drawProjLst.row(this).data().PROJ_NAME;
						evtCpnt.children("i").removeClass("hide");
					} else {
						rtnProjCode = "";
						rtnProjName = "";
						evtCpnt.children("i").addClass("hide");
					}
				});
			});	
		</script>
</body>
</html>